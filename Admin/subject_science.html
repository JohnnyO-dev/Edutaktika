<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="../CSS/header.css">
    <link rel="stylesheet" href="../CSS/subject.css">
    <link rel="stylesheet" href="../CSS/footer.css">
    <link rel="icon" type="image/png" href="../images/icons/chemistry.png" />
    <title>Science</title>
    <style>
        nav ul {
            display: flex;
            align-items: center;
            padding: 0;
            margin: 0;
        }
        nav ul li {
            list-style: none;
            margin: 0 10px;
            position: relative;
            height: 100%;
            display: flex;
            align-items: center;
        }
        nav ul li a, nav ul li .dropbtn {
            display: flex;
            align-items: center;
            height: 48px; /* Match your nav height */
            line-height: 48px;
            padding: 0 18px;
            color: #2d3923;
            text-decoration: none;
            font-size: 1rem;
            background: none;
            border: none;
            cursor: pointer;
        }
        nav ul li .dropdown-content {
            display: none;
            position: absolute;
            background: #fff;
            min-width: 120px;
            box-shadow: 0 4px 16px #0002;
            z-index: 1000;
            border-radius: 8px;
            padding: 0;
            margin: 0;
            top: 100%;
            left: 0;
        }
        nav ul li .dropdown-content li {
            list-style: none;
            border-bottom: 1px solid #eee;
        }
        nav ul li .dropdown-content li:last-child {
            border-bottom: none;
        }
        nav ul li .dropdown-content a {
            color:  18px;
            color: #2d3923;
            padding: 10px 20px;
            display: block;
            text-decoration: none;
            border-radius: 0;
            transition: background 0.2s;
            height: auto;
            line-height: normal;
        }
        nav ul li .dropdown-content a:hover {
            background: #f0f0f0;
        }
        nav ul li.dropdown:hover .dropdown-content {
            display: block;
        }
    </style>
</head>

<body>
    
   <header>
        <div class="floating-elements">
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <div class="floating-element"></div>
        </div>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <!-- Replace your logo-text div with this for per-letter bounce -->
                <div class="logo-text">
                    <span>E</span><span>d</span><span>u</span><span>t</span><span>a</span><span>k</span><span>t</span><span>i</span><span>k</span><span>a</span>
                </div>
            </div>
            <nav>
                <ul>
                    
                    <li class="dropdown">
                        <a href="#" class="dropbtn">Subject <i class="fa fa-caret-down"></i></a>
                        <ul class="dropdown-content">
                            <li><a href="subject_math.html">Math</a></li>
                            <li><a href="subject_english.html">English</a></li>
                            <li><a href="subject_science.html">Science</a></li>
                        </ul>
                    </li>
                    <li><a href="studentlist.html">Teacher</a></li>
                    
                </ul>
            </nav>
        </div>
    </header>



    <!-- Firebase App (the core Firebase SDK) -->
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>



    <script src="../assets/js/Admin/header.js"></script>


   
<style>
.math-title-animated {
    font-size: 4rem;
    font-weight: 800;
    color: #ff9800;
    margin-bottom: 8px;
    letter-spacing: 2px;
    animation: bounceIn 1s;
    text-shadow: 0 4px 24px #ff980055, 0 1px 0 #fff;
}
.math-desc-animated {
    font-size: 1.25rem;
    color: #388e3c;
    margin-bottom: 0;
    animation: fadeInUp 1.2s;
    font-weight: 500;
    text-shadow: 0 2px 12px #388e3c22;
}
@keyframes bounceIn {
    0% { transform: scale(0.8); opacity: 0; }
    60% { transform: scale(1.1); opacity: 1; }
    80% { transform: scale(0.95); }
    100% { transform: scale(1); }
}
@keyframes fadeInUp {
    0% { opacity: 0; transform: translateY(30px);}
    100% { opacity: 1; transform: translateY(0);}
}
.math-header {
    background:white;
    opacity: 0.95;
    border-radius: 18px;
    box-shadow: 0 4px 24px #ff980022;
    padding: 32px 0 24px 0;
    margin-bottom: 32px;
    position: relative;
    overflow: hidden;
}
.math-header::before {
    content: '';
    position: absolute;
    left: 10%;
    top: -40px;
    width: 80px;
    height: 80px;
    background: radial-gradient(circle, #ff9800 60%, transparent 100%);
    opacity: 0.25;
    border-radius: 50%;
    animation: floatMath 3s infinite alternate;
}
.math-header::after {
    content: '';
    position: absolute;
    right: 10%;
    bottom: -30px;
    width: 60px;
    height: 60px;
    background: radial-gradient(circle, #388e3c 60%, transparent 100%);
    opacity: 0.18;
    border-radius: 50%;
    animation: floatMath 2.5s infinite alternate-reverse;
}
@keyframes floatMath {
    0% { transform: translateY(0);}
    100% { transform: translateY(20px);}
}
</style>
   

    <div class="container">
        
    <!-- Add this inside your .container div, above the quarter navigation -->
  <div class="math-header" style="margin-bottom:32px;text-align:center;">
    <h1 class="math-title-animated">Science Subject</h1>
    <p class="math-desc-animated">Master science through engaging, game-based lessons and quizzes</p>
</div>

    <!-- Add these buttons above your quarter navigation (inside .container) -->
        <div style="display:flex;gap:18px;margin-bottom:24px;">
            <button id="createLessonBtn" style="background:#388e3c;color:#fff;border:none;border-radius:6px;padding:10px 28px;font-size:1.1rem;font-weight:600;cursor:pointer;">
                <i class="fa fa-plus"></i> Create Lesson
            </button>
            <button id="createQuizBtn" style="background:#ffe600;color:#000;border:none;border-radius:6px;padding:10px 28px;font-size:1.1rem;font-weight:600;cursor:pointer;margin-left: auto;">
                <i class="fa fa-plus"></i> Create Quiz
            </button>
        </div>

    <script>
        // Create Lesson button: go to Editor.html (new lesson)
        // Updated: navigate to built Editor dist with subject param
        document.getElementById('createLessonBtn').onclick = function() {
            const subject='subject_science';
            const params=new URLSearchParams({subject});
            const isLocal=location.hostname==='localhost'||location.hostname==='127.0.0.1';
            const dev=`http://localhost:5173/?${params.toString()}`;
            const prod=`/Editor/dist/index.html?${params.toString()}`;
            window.location.href=isLocal?dev:prod;
        };

        // Quiz Section button: go to quiz section page (replace with your quiz page)
        document.getElementById('quizSectionBtn').onclick = function() {
            window.location.href = 'quizSection.html';
        };
    </script>

        <!-- Quarter Navigation -->
        <div class="quarter-nav">
            <div class="quarter-tab active" data-quarter="1">Quarter 1</div>
            <div class="quarter-tab" data-quarter="2">Quarter 2</div>
            <div class="quarter-tab" data-quarter="3">Quarter 3</div>
            <div class="quarter-tab" data-quarter="4">Quarter 4</div>
            <div class="quarter-tab" data-quarter="5" style="margin-left: auto;" >Quizzes</div>
        </div>

        <!-- Quarter 1 -->
        <div class="quarter-section active" id="quarter-1">
            <div class="quarter-title">
                <i class="fas fa-calendar-alt"></i>
                <h2>
                    Quarter 1: 
                    <span class="bounce-word">
                        <span>F</span><span>o</span><span>u</span><span>n</span><span>d</span><span>a</span><span>t</span><span>i</span><span>o</span><span>n</span><span>s</span>
                    </span>
                </h2>
            </div>

            <div class="lessons-container">
                

                
            </div>

            <!-- <div class="progress-container">
                <div class="progress-title">Quarter Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%"></div>
                </div>
                <div class="progress-stats">
                    <span>65% Complete</span>
                    <span>2/3 Lessons Finished</span>
                </div>
            </div>

            <div class="badges-container">
                <div class="badges-title">Earned Badges</div>
                <div class="badges-list">
                    <div class="badge" data-tooltip="Time Master">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="badge" data-tooltip="Shape Explorer">
                        <i class="fas fa-shapes"></i>
                    </div>
                </div>
            </div> -->
        </div>

        <!-- Quarter 2 -->
        <div class="quarter-section" id="quarter-2">
            <div class="quarter-title">
                <i class="fas fa-calendar-alt"></i>
                 <h2>
                    Quarter 2: 
                    <span class="bounce-word">
                        <span>F</span><span>o</span><span>u</span><span>n</span><span>d</span><span>a</span><span>t</span><span>i</span><span>o</span><span>n</span><span>s</span>
                    </span>
                </h2>
            </div>

            <div class="lessons-container">
                
            </div>

            <!-- <div class="progress-container">
                <div class="progress-title">Quarter Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%"></div>
                </div>
                <div class="progress-stats">
                    <span>65% Complete</span>
                    <span>2/3 Lessons Finished</span>
                </div>
            </div>

            <div class="badges-container">
                <div class="badges-title">Earned Badges</div>
                <div class="badges-list">
                    <div class="badge" data-tooltip="Time Master">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="badge" data-tooltip="Shape Explorer">
                        <i class="fas fa-shapes"></i>
                    </div>
                </div>
            </div> -->
        </div>

        <!-- Quarter 3 -->
        <div class="quarter-section" id="quarter-3">
            <div class="quarter-title">
                <i class="fas fa-calendar-alt"></i>
                <h2>Quarter 3: Decimals & Percentages</h2>
            </div>

            <div class="lessons-container">
                
            </div>

            <!-- <div class="progress-container">
                <div class="progress-title">Quarter Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%"></div>
                </div>
                <div class="progress-stats">
                    <span>65% Complete</span>
                    <span>2/3 Lessons Finished</span>
                </div>
            </div>

            <div class="badges-container">
                <div class="badges-title">Earned Badges</div>
                <div class="badges-list">
                    <div class="badge" data-tooltip="Time Master">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="badge" data-tooltip="Shape Explorer">
                        <i class="fas fa-shapes"></i>
                    </div>
                </div>
            </div> -->
        </div>

        <!-- Quarter 4 -->
        <div class="quarter-section" id="quarter-4">
            <div class="quarter-title">
                <i class="fas fa-calendar-alt"></i>
                <h2>Quarter 4: Geometry & Measurement</h2>
            </div>

            <div class="lessons-container">
                
            </div>

            <!-- <div class="progress-container">
                <div class="progress-title">Quarter Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%"></div>
                </div>
                <div class="progress-stats">
                    <span>65% Complete</span>
                    <span>2/3 Lessons Finished</span>
                </div>
            </div>

            <div class="badges-container">
                <div class="badges-title">Earned Badges</div>
                <div class="badges-list">
                    <div class="badge" data-tooltip="Time Master">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="badge" data-tooltip="Shape Explorer">
                        <i class="fas fa-shapes"></i>
                    </div>
                </div>
            </div> -->
        </div>

        <!-- Quizzes -->
        <div class="quarter-section" id="quarter-5">
            <div class="quarter-title" style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <i class="fas fa-calendar-alt"></i>
                    <h2 style="display:inline-block;margin:0 0 0 8px;">Quizzes</h2>
                </div>
                <div style="display: flex; align-items: center;">
                    <label for="quiz-quarter-filter" style="font-weight:600; margin-right:8px;">Filter by Quarter:</label>
                    <select id="quiz-quarter-filter" style="min-width:120px;">
                        <option value="1">Quarter 1</option>
                        <option value="2">Quarter 2</option>
                        <option value="3">Quarter 3</option>
                        <option value="4">Quarter 4</option>
                    </select>
                </div>
            </div>
            <div class="lessons-container">
                <div id="quiz-list"></div>
            </div>
        </div>
    </div>

    <script src="../assets/js/Teacher Side/subject.js"></script>

    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h3 class="edu">Eduktaktika</h3>
                <p>
                    Making learning fun and engaging through interactive game-based
                    education.
                </p>
            </div>
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="homepage.php">Home</a></li>
                    <li><a href="subjectTeacher.php">Subject</a></li>
                    <li><a href="studentlistTeacher.php">Student</a></li>
                    <li><a href="leaderboardTeacher.php">Leaderboard</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Support</h3>
                <ul>
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="footer-links">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
            </div>
            <p>Â© 2023 Eduktaktika. All rights reserved.</p>
        </div>
    </footer>

</body>


<script>
const firebaseConfig = {
    apiKey: "AIzaSyB5BbeLLvPX8l1c4Lq0f-CmIUml4hQOQlE",
    authDomain: "edutaktika.firebaseapp.com",
    databaseURL: "https://edutaktika-default-rtdb.firebaseio.com",
    projectId: "edutaktika",
    storageBucket: "edutaktika.appspot.com",
    messagingSenderId: "676848575316",
    appId: "1:676848575316:web:f78f8c0f83bf3d9dfb5ec1",
    measurementId: "G-X3GT5TNN87"
};
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();
</script>

<script>

// Instead, for admin, load global presentations for this subject and display them:
const subjectPage = "subject_science"; // For this page

async function loadGlobalPresentations() {
    for (let q = 1; q <= 4; q++) {
        const container = document.querySelector(`#quarter-${q} .lessons-container`);
        if (!container) continue;
        container.innerHTML = '';
        const snap = await db.ref('presentations/' + subjectPage + '/quarter-' + q).once('value');
        if (!snap.exists()) {
            container.innerHTML = "<div>No global lessons found for this subject and quarter.</div>";
            continue;
        }
        snap.forEach(child => {
            const data = child.val();
            const name = data.title || child.key;
            const item = document.createElement('div');
            item.className = 'lesson-item';
            item.setAttribute('data-presentation', name);
            item.innerHTML = `
                <div class="lesson-thumbnail" style="background-color: var(--peach)"></div>
                <div class="lesson-title">
                    <h3>${name}</h3>
                    <p>${data.description ? data.description : ''}</p>
                    <span class="lesson-badge" onclick="viewPresentation('${q}','${name}','view','${subjectPage}')" style="cursor:pointer;">View</span>
                    <button class="lesson-badge" onclick="viewPresentation('${q}','${name}','edit','${subjectPage}')" style="cursor:pointer;">Edit</button>
                </div>
            `;
            container.appendChild(item);
        });
    }
}
loadGlobalPresentations();

function viewPresentation(quarter, name, mode = 'view', subject = subjectPage) {
    const params = `quarter=${encodeURIComponent(quarter)}&name=${encodeURIComponent(name)}&subject=${encodeURIComponent(subject)}`;
    if (mode === 'edit') {
        window.location.href = 'Editor.html?' + params;
    } else {
        window.location.href = 'present.html?' + params;
    }
}
</script>

<style>
    #createLessonModal {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.35);
        z-index: 99999;
        align-items: center;
        justify-content: center;
    }
    #createLessonModal .modal-content {
        background: #fff;
        padding: 32px 28px;
        border-radius: 16px;
        max-width: 370px;
        width: 90%;
        box-shadow: 0 4px 24px #0002;
        text-align: left;
        position: relative;
        animation: modalPop 0.25s;
    }
        @keyframes modalPop {
        0% { transform: scale(0.95); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
    }
    #createLessonModal h3 {
        margin-top: 0;
        margin-bottom: 18px;
        font-size: 1.35rem;
        color: #059981;
        letter-spacing: 1px;
    }
    #createLessonModal label {
        font-weight: 500;
        color: #2d3923;
        font-size: 1rem;
    }
    #createLessonModal input, #createLessonModal select, #createLessonModal textarea {
        width: 100%;
        padding: 8px 10px;
        margin-top: 4px;
        margin-bottom: 12px;
        border: 1px solid #b2b2b2;
        border-radius: 6px;
        font-size: 1rem;
        background: #f8f8f8;
        transition: border 0.2s;
    }
    #createLessonModal input:focus, #createLessonModal select:focus, #createLessonModal textarea:focus {
        border: 1.5px solid #059981;
        outline: none;
        background: #fff;
    }
    #createLessonModal .modal-actions {
        text-align: right;
        margin-top: 10px;
    }
    #createLessonModal button[type="button"] {
        background: #eee;
        color: #333;
        border: none;
        border-radius: 6px;
        padding: 8px 18px;
        font-size: 1rem;
        margin-right: 8px;
        cursor: pointer;
        transition: background 0.2s;
    }
    #createLessonModal button[type="button"]:hover {
        background: #e0e0e0;
    }
    #createLessonModal button[type="submit"] {
        background: #059981;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 8px 22px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }
    #createLessonModal button[type="submit"]:hover {
        background: #037a65;
    }
</style>

<!-- Add this near the end of your body, before </body> -->
<div id="createLessonModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:99999;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:32px 28px;border-radius:14px;max-width:350px;width:90%;box-shadow:0 4px 24px #0002;text-align:left;position:relative;">
        <h3 style="margin-top:0;">Create New Global Lesson</h3>
        <form id="createLessonForm">
            <label>Subject:<br>
                <select id="lesson_subject" required>
                    <option value="">Select Subject</option>
                    <option value="subject_math">Math</option>
                    <option value="subject_science">Science</option>
                    <option value="subject_english">English</option>
                </select>
            </label><br><br>
            <label>Quarter:<br>
                <select id="lesson_quarter" required>
                    <option value="">Select Quarter</option>
                    <option value="1">Quarter 1</option>
                    <option value="2">Quarter 2</option>
                    <option value="3">Quarter 3</option>
                    <option value="4">Quarter 4</option>
                </select>
            </label><br><br>
            <label>Title:<br>
                <input type="text" id="lesson_title" required>
            </label><br><br>
            <label>Description:<br>
                <textarea id="lesson_desc" rows="2"></textarea>
            </label><br><br>
            <div style="text-align:right;">
                <button type="button" onclick="closeCreateLessonModal()" style="margin-right:10px;">Cancel</button>
                <button type="submit">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
// Set the subject page variable based on the current page
// For the admin global page, let the admin choose the subject
// Remove all teacher/student logic

// Show modal on Create Lesson click
document.getElementById('createLessonBtn').onclick = function() {
    document.getElementById('createLessonModal').style.display = 'flex';
};

// Hide modal function
function closeCreateLessonModal() {
    document.getElementById('createLessonModal').style.display = 'none';
}

// Handle global lesson creation
document.getElementById('createLessonForm').onsubmit = async function(e) {
    e.preventDefault();
    const subjectPage = document.getElementById('lesson_subject').value;
    const quarter = document.getElementById('lesson_quarter').value;
    const title = document.getElementById('lesson_title').value.trim();
    const desc = document.getElementById('lesson_desc').value.trim();

    if (!subjectPage || !quarter || !title) {
        alert('Subject, Quarter, and Title are required!');
        return;
    }

    const blankSlide = JSON.stringify([{
        version: "5.2.4",
        objects: [],
        backgroundColor: "#fff"
    }]);

    const lessonData = {
        slides: blankSlide,
        title: title,
        quarter: quarter,
        description: desc,
        savedAt: new Date().toISOString()
    };

    // Save only to global presentations
    await db.ref('presentations/' + subjectPage + '/quarter-' + quarter + '/' + title).set(lessonData);

    // ALSO copy to all teachers' sections
    const teachersSnap = await db.ref('teachers').once('value');
    if (teachersSnap.exists()) {
        teachersSnap.forEach(teacherSnap => {
            const teacherUID = teacherSnap.key;
            const teacher = teacherSnap.val();
            if (teacher && teacher.section) {
                db.ref('teachers/' + teacherUID + '/sections/' + teacher.section + '/lessons/' + subjectPage + '/quarter-' + quarter + '/' + title).set(lessonData);
            }
        });
    }

    // Immediately redirect to Editor.html for the new lesson
    const params = `quarter=${encodeURIComponent(quarter)}&name=${encodeURIComponent(title)}&subject=${encodeURIComponent(subjectPage)}`;
    window.location.href = 'Editor.html?' + params;
};

</script>

<script>


// Load quizzes for the selected quarter from GLOBAL ONLY
async function loadGlobalQuizzes(quarter) {
    const quizList = document.getElementById('quiz-list');
    quizList.innerHTML = '<div style="color:#888;">Loading...</div>';

    // Load quizzes from global path only
    const snap = await db.ref('quizzes/' + subjectPage + '/quarter-' + quarter).once('value');
    if (!snap.exists()) {
        quizList.innerHTML = "<div>No quizzes found for this quarter.</div>";
        return;
    }
    let quizzes = [];
    snap.forEach(child => {
        const data = child.val();
        quizzes.push({
            title: data.title || child.key,
            description: data.description || '',
            quarter: data.quarter || quarter
        });
    });
    // Sort quizzes alphabetically
    quizzes.sort((a, b) => a.title.localeCompare(b.title));
    quizList.innerHTML = quizzes.map(quiz => `
        <div class="lesson-item" data-quiz="${quiz.title}">
            <div class="lesson-thumbnail" style="background-color: #ffdd01"></div>
            <div class="lesson-title">
                <h3>${quiz.title}</h3>
                <p>${quiz.description}</p>
                <button class="lesson-badge" onclick="viewQuiz('${quiz.quarter}','${quiz.title}','view','${subjectPage}')" style="cursor:pointer;">View</button>
                <button class="lesson-badge" onclick="viewQuiz('${quiz.quarter}','${quiz.title}','edit','${subjectPage}')" style="cursor:pointer;">Edit</button>
            </div>
        </div>
    `).join('');
}

// Listen for filter changes and load global quizzes
document.addEventListener('DOMContentLoaded', function() {
    const filter = document.getElementById('quiz-quarter-filter');
    if (!filter) return;
    filter.value = '1';
    loadGlobalQuizzes('1');
    filter.disabled = false;
    filter.onchange = function() {
        loadGlobalQuizzes(this.value);
    };
});

// Helper for view/edit
function viewQuiz(quarter, name, mode = 'view', subject = subjectPage) {
    const params = `quarter=${encodeURIComponent(quarter)}&name=${encodeURIComponent(name)}&subject=${encodeURIComponent(subject)}`;
    if (mode === 'edit') {
        window.location.href = 'quizEditor.html?' + params;
    } else {
        window.location.href = 'quizView.html?' + params;
    }
}
</script>

<div id="createQuizModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:99999;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:32px 28px;border-radius:14px;max-width:350px;width:90%;box-shadow:0 4px 24px #0002;text-align:left;position:relative;">
        <h3 style="margin-top:0;">Create New Quiz</h3>
        <form id="createQuizForm">
            <label>Quarter:<br>
                <select id="quiz_quarter" required>
                    <option value="">Select Quarter</option>
                    <option value="1">Quarter 1</option>
                    <option value="2">Quarter 2</option>
                    <option value="3">Quarter 3</option>
                    <option value="4">Quarter 4</option>
                </select>
            </label><br><br>
            <label>Title:<br>
                <input type="text" id="quiz_title" required>
            </label><br><br>
            <label>Description:<br>
                <textarea id="quiz_desc" rows="2"></textarea>
            </label><br><br>
            <div style="text-align:right;">
                <button type="button" onclick="closeCreateQuizModal()" style="margin-right:10px;">Cancel</button>
                <button type="submit">Save</button>
            </div>
        </form>
    </div>
</div>

<style>
    #createQuizModal {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.35);
        z-index: 99999;
        align-items: center;
        justify-content: center;
    }
    #createQuizModal .modal-content {
        background: #fff;
        padding: 32px 28px;
        border-radius: 16px;
        max-width: 370px;
        width: 90%;
        box-shadow: 0 4px 24px #0002;
        text-align: left;
        position: relative;
        animation: modalPop 0.25s;
    }
        @keyframes modalPop {
        0% { transform: scale(0.95); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
    }
    #createQuizModal h3 {
        margin-top: 0;
        margin-bottom: 18px;
        font-size: 1.35rem;
        color: #059981;
        letter-spacing: 1px;
    }
    #createQuizModal label {
        font-weight: 500;
        color: #2d3923;
        font-size: 1rem;
    }
    #createQuizModal input, #createQuizModal select, #createQuizModal textarea {
        width: 100%;
        padding: 8px 10px;
        margin-top: 4px;
        margin-bottom: 12px;
        border: 1px solid #b2b2b2;
        border-radius: 6px;
        font-size: 1rem;
        background: #f8f8f8;
        transition: border 0.2s;
    }
    #createQuizModal input:focus, #createQuizModal select:focus, #createQuizModal textarea:focus {
        border: 1.5px solid #059981;
        outline: none;
        background: #fff;
    }
    #createQuizModal .modal-actions {
        text-align: right;
        margin-top: 10px;
    }
    #createQuizModal button[type="button"] {
        background: #eee;
        color: #333;
        border: none;
        border-radius: 6px;
        padding: 8px 18px;
        font-size: 1rem;
        margin-right: 8px;
        cursor: pointer;
        transition: background 0.2s;
    }
    #createQuizModal button[type="button"]:hover {
        background: #e0e0e0;
    }
    #createQuizModal button[type="submit"] {
        background: #059981;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 8px 22px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }
    #createLessonModal button[type="submit"]:hover {
        background: #037a65;
    }
</style>

<script>
    // Show modal on Create Quiz click
    document.getElementById('createQuizBtn').onclick = function() {
        document.getElementById('createQuizModal').style.display = 'flex';
    };
    function closeCreateQuizModal() {
        document.getElementById('createQuizModal').style.display = 'none';
    }

    // Handle quiz creation and save to global AND all teacher sections
    document.getElementById('createQuizForm').onsubmit = async function(e) {
        e.preventDefault();
        const quarter = document.getElementById('quiz_quarter').value;
        const title = document.getElementById('quiz_title').value.trim();
        const desc = document.getElementById('quiz_desc').value.trim();

        if (!quarter || !title) {
            alert('Quarter and Title are required!');
            return;
        }

        const subjectPage = "subject_math";
        const quizData = {
            questions: [],
            title: title,
            quarter: quarter,
            description: desc,
            savedAt: new Date().toISOString()
        };

        // Save to global quizzes
        await db.ref('quizzes/' + subjectPage + '/quarter-' + quarter + '/' + title).set(quizData);

        // ALSO copy to all teachers' sections
        const teachersSnap = await db.ref('teachers').once('value');
        if (teachersSnap.exists()) {
            teachersSnap.forEach(teacherSnap => {
                const teacherUID = teacherSnap.key;
                const teacher = teacherSnap.val();
                if (teacher && teacher.section) {
                    db.ref('teachers/' + teacherUID + '/sections/' + teacher.section + '/quizzes/' + subjectPage + '/' + quarter + '/' + title).set(quizData);
                }
            });
        }

        closeCreateQuizModal();

        // Redirect to quizEditor.html for editing the new quiz
        const params = `quarter=${encodeURIComponent(quarter)}&name=${encodeURIComponent(title)}&subject=${encodeURIComponent(subjectPage)}`;
        window.location.href = 'quizEditor.html?' + params;
    };
</script>

</body>

</html>