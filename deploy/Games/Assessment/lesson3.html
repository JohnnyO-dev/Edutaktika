<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplication of Fractions Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #e3f6fc;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 700px;
            margin: 111px auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px #b2e4fa;
            padding: 32px;
            text-align: center;
        }
        .problem {
            font-size: 1.4rem;
            margin-bottom: 24px;
            padding: 16px;
            border: 2px solid #2e8b57;
            border-radius: 10px;
            background: #f0fff0;
        }
        .draggables {
            display: flex;
            gap: 18px;
            justify-content: center;
            margin-bottom: 32px;
        }
        .draggable {
            background: #ffd700;
            color: #2e8b57;
            border-radius: 10px;
            padding: 18px 0;
            width: 120px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: grab;
            border: 2px solid #2e8b57;
            box-shadow: 0 2px 8px #b2e4fa;
            text-align: center;
            user-select: none;
            transition: background 0.2s, color 0.2s;
        }
        .draggable.dragging {
            opacity: 0.7;
            background: #2e8b57;
            color: #fff;
        }
        .dropzone {
            border: 2px dashed #2e8b57;
            background: #e9ffe9;
            border-radius: 12px;
            min-height: 54px;
            width: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #3f4d34;
            margin: 0 auto 24px auto;
            transition: background 0.2s, border 0.2s;
        }
        .dropzone.active {
            background: #ffd700;
            border-color: #2e8b57;
        }
        #feedback {
            font-size: 1.2rem;
            margin-top: 18px;
            min-height: 28px;
            font-weight: bold;
        }
        #nextBtn {
            padding: 12px 36px;
            border-radius: 10px;
            background: #2e8b57;
            color: #fff;
            border: none;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 18px;
            box-shadow: 0 2px 8px #b2e4fa;
            display: none;
        }
        #score {
            font-size: 1.1rem;
            margin-top: 18px;
            color: #2e8b57;
        }
        /* Modal styles */
        .modal-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-bg.active {
            display: flex;
        }
        .modal-content {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90vw;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            position: relative;
            text-align: center;
        }
        .modal-content h2 {
            margin: 0 0 16px 0;
            font-size: 1.8rem;
            color: #2e8b57;
        }
        .modal-content p, .modal-content ul {
            margin: 0 0 12px 0;
            font-size: 1.1rem;
            color: #333;
        }
        .modal-btn {
            background: #2e8b57;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 12px;
            transition: background 0.3s;
        }
        .modal-btn:hover {
            background: #236d4d;
        }
        /* Edit modal specific styles */
        #editModal .modal-content.edit-modal-content {
            background: #fff;
            color: #2e8b57;
            padding: 32px 24px;
            border-radius: 16px;
            max-width: 480px;
            width: 96vw;
            box-shadow: 0 4px 24px #ff69b4;
            text-align: center;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
            
        }
        .edit-modal-content label, .edit-modal-content input, .edit-modal-content textarea {
            font-size: 1.1rem;
            margin-bottom: 8px;
            width: 90%;
            display: block;
        }
        .edit-modal-content input, .edit-modal-content textarea {
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #2e8b57;
            margin-bottom: 12px;
        }
        .edit-modal-content textarea {
            resize: vertical;
            min-height: 40px;
        }
        .edit-question-block {
            background: #e9ffe9;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 18px;
            box-shadow: 0 2px 8px #ff69b4;
        }
        .remove-question-btn {
            background: #ff69b4;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 6px 18px;
            font-size: 1rem;
            cursor: pointer;
            float: right;
            margin-top: -8px;
            margin-right: -8px;
            
        }
        @media (max-width: 700px) {
          #editModal .modal-content.edit-modal-content {
            padding: 12px 2vw !important;
            max-width: 100vw !important;
            width: 100vw !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            max-height: 90vh !important;
          }
          .edit-question-block label,
          .edit-question-block input,
          .edit-question-block textarea {
            font-size: 0.95rem !important;
            width: 98vw !important;
            min-width: 0 !important;
          }
          .edit-question-block {
            padding: 8px !important;
            margin-bottom: 12px !important;
          }
          .remove-question-btn {
            font-size: 0.95rem !important;
            padding: 4px 12px !important;
          }
        }
        /* Move Edit Questions button to top right and fix its logic */
        #editBtn {
          position: absolute;
          top: 24px;
          right: 32px;
          z-index: 1100;
          margin-top: 0 !important;
          display: none;
        }
        #answerModalNextBtn, #answerModalPlayAgainBtn {
          display: none;
          margin-left: auto;
          margin-right: auto;
          float: none;
        }
        .modal-content button {
          display: block;
          margin-left: auto;
          margin-right: auto;
          float: none;
        }
    </style>
</head>
<body>
    <!-- Start Modal -->
    <div class="modal-bg active" id="startModal">
        <div class="modal-content">
            <h2>Multiplication of Fractions Game</h2>
            <p>Welcome! Test your skills in multiplying fractions.<br>Click Start to begin.</p>
            <button class="modal-btn" id="startBtn">Start</button>
        </div>
    </div>
    <!-- Instructions Modal -->
    <div class="modal-bg" id="instructionsModal">
        <div class="modal-content">
            <h2>Instructions</h2>
            <ul style="text-align:left;">
                <li>Read the fraction multiplication problem.</li>
                <li>Drag the correct answer and drop it into the answer box.</li>
                <li>Click "Next" to proceed to the next question.</li>
                <li>Try to get all questions correct!</li>
            </ul>
            <button class="modal-btn" id="continueBtn">Continue</button>
        </div>
    </div>
    <!-- Edit Questions Button (top right, hidden by default) -->
    <button class="modal-btn" id="editBtn">Edit Questions</button>    
    <div class="container" id="gameContainer" style="display:none; position:relative;">
        <h1>Multiplication of Fractions</h1>
        <div class="problem" id="problem"></div>
        <div class="draggables" id="draggables"></div>
        <div class="dropzone" id="dropzone">Drop your answer here</div>
        <div id="feedback"></div>
        <button id="nextBtn">Next</button>
        <div id="score"></div>
    </div>
    <!-- Final Modal -->
    <div class="modal-bg" id="finalModal">
        <div class="modal-content">
          <h2>Congratulations!</h2>
          <p id="finalScore"></p>
          <button id="playAgainBtn">Play Again</button>
        </div>
    </div>
    <!-- Wrong Answer Modal -->
    <div class="modal-bg" id="wrongModal">
        <div class="modal-content" style="align-items: center;">
          <h2>Incorrect!</h2>
          <p id="wrongSteps"></p>
          <p id="wrongFinal"></p>
          <button class="modal-btn" id="wrongContinueBtn" >Next Question</button>
          <button class="modal-btn" id="wrongPlayAgainBtn" style="display:none;">Play Again</button>
        </div>
    </div>
    <!-- Edit Modal (styled like lesson1) -->
    <div class="modal-bg" id="editModal">
        <div class="modal-content edit-modal-content" style="max-width:600px;width:96vw;border-radius:16px;box-shadow:0 4px 24px #ff69b4;max-height:80vh;overflow-y:auto;">
          <h2>Edit Questions</h2>
          <div id="editQuestionsList"></div>
          <button class="modal-btn" id="addQuestionBtn">Add Question</button>
          <button class="modal-btn" id="saveEditBtn">Save</button>
          <button class="modal-btn" id="cancelEditBtn">Cancel</button>
        </div>
    </div>
    <!-- Answer Modal -->
    <div class="modal-bg" id="answerModal">
        <div class="modal-content">
            <h2 id="answerModalTitle"></h2>
            <p id="answerModalMessage"></p>
            <button class="modal-btn" id="answerModalNextBtn" style="display:none;">Next Question</button>
            <button class="modal-btn" id="answerModalPlayAgainBtn" style="display:none;">Play Again</button>
        </div>
    </div>

    <script>
        // Load questions from localStorage if available
        let defaultQuestions = [
            {
                q: "1/4 × 2/5",
                choices: ["2/20", "3/20", "2/9"],
                a: "2/20"
            },
            {
                q: "3/7 × 2/3",
                choices: ["6/21", "5/10", "1/7"],
                a: "6/21"
            },
            {
                q: "5/8 × 4/5",
                choices: ["20/40", "9/13", "1/2"],
                a: "20/40"
            }
        ];
        let questions = [];
        if (localStorage.getItem('fractionQuestions')) {
            questions = JSON.parse(localStorage.getItem('fractionQuestions'));
        } else {
            questions = JSON.parse(JSON.stringify(defaultQuestions));
        }
        let current = 0;
        let score = 0;

        // Modal logic
        document.getElementById('startBtn').onclick = function() {
            document.getElementById('startModal').classList.remove('active');
            document.getElementById('instructionsModal').classList.add('active');
        };
        document.getElementById('continueBtn').onclick = function() {
            document.getElementById('instructionsModal').classList.remove('active');
            document.getElementById('gameContainer').style.display = '';
            document.getElementById('editBtn').style.display = 'block'; // Show after instructions
            loadQuestion();
        };

        function loadQuestion() {
            document.getElementById('problem').textContent = questions[current].q;
            document.getElementById('feedback').textContent = '';
            document.getElementById('dropzone').textContent = "Drop your answer here";
            document.getElementById('dropzone').className = "dropzone";
            document.getElementById('nextBtn').style.display = "none";
            document.getElementById('score').textContent = `Score: ${score} / ${questions.length}`;
            // Draggables
            const draggablesDiv = document.getElementById('draggables');
            draggablesDiv.innerHTML = "";
            questions[current].choices.forEach((ans, idx) => {
                const div = document.createElement('div');
                div.className = "draggable";
                div.draggable = true;
                div.id = "choice" + idx;
                div.textContent = ans;
                draggablesDiv.appendChild(div);
            });
            addDragDropListeners();
        }

        function addDragDropListeners() {
            let dragged = null;
            document.querySelectorAll('.draggable').forEach(elem => {
                elem.addEventListener('dragstart', function(ev) {
                    dragged = ev.target;
                    setTimeout(() => {
                        ev.target.classList.add('dragging');
                    }, 0);
                    ev.dataTransfer.setData("text", ev.target.id);
                });
                elem.addEventListener('dragend', function(ev) {
                    ev.target.classList.remove('dragging');
                    dragged = null;
                });
            });

            const dropzone = document.getElementById('dropzone');
            dropzone.ondragover = function(ev) {
                ev.preventDefault();
                dropzone.classList.add('active');
            };
            dropzone.ondragleave = function(ev) {
                dropzone.classList.remove('active');
            };
            dropzone.ondrop = function(ev) {
                ev.preventDefault();
                dropzone.classList.remove('active');
                if (dropzone.textContent !== "Drop your answer here") return;
                const data = ev.dataTransfer.getData("text");
                const answer = document.getElementById(data);
                dropzone.textContent = answer.textContent;
                let correct = false;
                if (answer.textContent === questions[current].a) {
                    dropzone.classList.add("correct");
                    correct = true;
                    score++;
                } else {
                    dropzone.classList.add("incorrect");
                }
                document.getElementById('score').textContent = `Score: ${score} / ${questions.length}`;

                // Show modal after answering
                document.getElementById('answerModal').classList.add('active');
                document.getElementById('answerModalNextBtn').style.display = "none";
                document.getElementById('answerModalPlayAgainBtn').style.display = "none";
                if (correct) {
                    if (current === questions.length - 1) {
                        document.getElementById('answerModalTitle').textContent = "Congratulations!";
                        document.getElementById('answerModalMessage').textContent = `Your final score: ${score} / ${questions.length}`;
                        document.getElementById('answerModalPlayAgainBtn').style.display = "block";
                    } else {
                        document.getElementById('answerModalTitle').textContent = "✅ Correct!";
                        document.getElementById('answerModalMessage').textContent = `${questions[current].q} = ${questions[current].a}`;
                        document.getElementById('answerModalNextBtn').style.display = "block";
                    }
                } else {
                    if (current === questions.length - 1) {
                        document.getElementById('answerModalTitle').textContent = "Incorrect!";
                        document.getElementById('answerModalMessage').textContent =
                            `The correct answer is ${questions[current].a}.<br>Your final score: ${score} / ${questions.length}`;
                        document.getElementById('answerModalPlayAgainBtn').style.display = "block";
                    } else {
                        document.getElementById('answerModalTitle').textContent = "Incorrect!";
                        document.getElementById('answerModalMessage').textContent =
                            `The correct answer is ${questions[current].a}.`;
                        document.getElementById('answerModalNextBtn').style.display = "block";
                    }
                }
            };
        }

        document.getElementById('nextBtn').onclick = function() {
            current++;
            if (current < questions.length) {
                loadQuestion();
            } else {
                document.getElementById('gameContainer').style.display = "none";
                document.getElementById('finalScore').textContent = `Your final score: ${score} / ${questions.length}`;
                document.getElementById('finalModal').classList.add('active');
            }
        };

        document.getElementById('playAgainBtn').onclick = function() {
            current = 0;
            score = 0;
            document.getElementById('finalModal').classList.remove('active');
            document.getElementById('gameContainer').style.display = "";
            document.getElementById('editBtn').style.display = 'block';
            loadQuestion();
        };

        document.getElementById('answerModalNextBtn').onclick = function() {
            document.getElementById('answerModal').classList.remove('active');
            current++;
            loadQuestion();
        };
        document.getElementById('answerModalPlayAgainBtn').onclick = function() {
            document.getElementById('answerModal').classList.remove('active');
            current = 0;
            score = 0;
            document.getElementById('gameContainer').style.display = "";
            document.getElementById('editBtn').style.display = 'block';
            loadQuestion();
        };

        // Hide modals on load except start
        window.onload = function() {
            document.getElementById('startModal').classList.add('active');
            document.getElementById('instructionsModal').classList.remove('active');
            document.getElementById('finalModal').classList.remove('active');
            document.getElementById('wrongModal').classList.remove('active');
            document.getElementById('editModal').classList.remove('active');
            document.getElementById('gameContainer').style.display = "none";
            document.getElementById('editBtn').style.display = 'none';
        };

        // Show Edit Questions button only after instructions modal is closed (when answering)
        document.getElementById('continueBtn').onclick = function() {
            document.getElementById('instructionsModal').classList.remove('active');
            document.getElementById('gameContainer').style.display = '';
            document.getElementById('editBtn').style.display = 'block'; // Show after instructions
            loadQuestion();
        };

        // Hide Edit button on start and instructions modals
        document.getElementById('startBtn').onclick = function() {
            document.getElementById('startModal').classList.remove('active');
            document.getElementById('instructionsModal').classList.add('active');
            document.getElementById('editBtn').style.display = 'none';
        };

        // Hide Edit button on final modal and play again
        document.getElementById('playAgainBtn').onclick = function() {
            current = 0;
            score = 0;
            document.getElementById('finalModal').classList.remove('active');
            document.getElementById('gameContainer').style.display = "";
            document.getElementById('editBtn').style.display = 'block';
            loadQuestion();
        };
        document.getElementById('answerModalPlayAgainBtn').onclick = function() {
            document.getElementById('answerModal').classList.remove('active');
            current = 0;
            score = 0;
            document.getElementById('gameContainer').style.display = "";
            document.getElementById('editBtn').style.display = 'block';
            loadQuestion();
        };

        // Fix Edit Questions button logic to open the edit modal
        document.getElementById('editBtn').onclick = function() {
            showEditModal();
            document.getElementById('editModal').classList.add('active');
        };
        document.getElementById('cancelEditBtn').onclick = function() {
            document.getElementById('editModal').classList.remove('active');
        };

        // Editable modal logic
        function showEditModal() {
            document.getElementById('editQuestionsList').innerHTML = '';
            questions.forEach((q, idx) => {
                document.getElementById('editQuestionsList').innerHTML += `
                    <div class="edit-question-block">
                        <button class="remove-question-btn" data-idx="${idx}" style="float: right; margin-top: -8px; margin-right: -8px;">Remove</button>
                        <label>Question:<br>
                            <input type="text" class="edit-q" value="${q.q.replace(/"/g, '&quot;')}">
                        </label>
                        <label>Choice 1:<br>
                            <input type="text" class="edit-choice1" value="${q.choices[0] ? q.choices[0].replace(/"/g, '&quot;') : ''}">
                        </label>
                        <label>Choice 2:<br>
                            <input type="text" class="edit-choice2" value="${q.choices[1] ? q.choices[1].replace(/"/g, '&quot;') : ''}">
                        </label>
                        <label>Choice 3:<br>
                            <input type="text" class="edit-choice3" value="${q.choices[2] ? q.choices[2].replace(/"/g, '&quot;') : ''}">
                        </label>
                        <label>Correct Answer:<br>
                            <input type="text" class="edit-a" value="${q.a.replace(/"/g, '&quot;')}">
                        </label>
                    </div>
                `;
            });
            // Remove logic
            document.querySelectorAll('.remove-question-btn').forEach(btn => {
                btn.onclick = function() {
                    const idx = Number(btn.dataset.idx);
                    questions.splice(idx, 1);
                    showEditModal();
                };
            });
        }

        document.getElementById('addQuestionBtn').onclick = function() {
            questions.push({
                q: "",
                choices: ["", "", ""],
                a: ""
            });
            showEditModal();
        };

        document.getElementById('saveEditBtn').onclick = function() {
            // Save edits
            let blocks = document.querySelectorAll('.edit-question-block');
            let newQuestions = [];
            blocks.forEach((block, idx) => {
                let q = block.querySelector('.edit-q').value.trim();
                let choices = [
                    block.querySelector('.edit-choice1').value.trim(),
                    block.querySelector('.edit-choice2').value.trim(),
                    block.querySelector('.edit-choice3').value.trim()
                ];
                let a = block.querySelector('.edit-a').value.trim();
                newQuestions.push({
                    q: q,
                    choices: choices,
                    a: a
                });
            });
            questions = newQuestions;
            localStorage.setItem('fractionQuestions', JSON.stringify(questions));
            document.getElementById('editModal').classList.remove('active');
            current = 0;
            score = 0;
            loadQuestion();
        };
    </script>
</body>
</html>
