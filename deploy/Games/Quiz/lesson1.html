<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lesson 1 Quiz - Time & World Time Zones</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="../../CSS/header.css">
    <link rel="stylesheet" href="../../CSS/footer.css">
    <style>
        :root {
            --primary: #2e8b57;
            --secondary: #ffd700;
            --peach: #ff69b4;
            --forest-green: #3f4d34;
            --sun-yellow: #ffd700;
            --white: #ffffff;
        }
    body { font-family: 'Baloo 2', Arial, sans-serif; background:#f5f7fb; margin:0; }
    main { padding:100px 20px 40px; min-height:calc(100vh - 260px); }
    .page-wrapper { display:flex; align-items:center; justify-content:center; }
        .game-container {
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 4px 24px var(--peach);
            padding: 32px;
            text-align: center;
            max-width: 500px;
            width: 96vw;
            position: relative;
        }
        .question {
            font-size: 1.3rem;
            margin-bottom: 24px;
            color: var(--forest-green);
            font-weight: bold;
        }
        .answers {
            display: flex;
            gap: 18px;
            margin-bottom: 32px;
            justify-content: center;
        }
        .draggable {
            background: var(--sun-yellow);
            color: var(--forest-green);
            border-radius: 50%;
            padding: 24px 0;
            width: 90px;
            height: 90px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: grab;
            border: 3px solid var(--primary);
            box-shadow: 0 2px 8px var(--peach);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            animation: float 2s infinite ease-in-out;
        }
        .draggable.dragging {
            opacity: 0.6;
            transform: scale(1.15) rotate(-8deg);
            box-shadow: 0 8px 24px var(--peach);
            z-index: 2;
        }
        @keyframes float {
            0% { transform: translateY(0);}
            50% { transform: translateY(-12px);}
            100% { transform: translateY(0);}
        }
        .dropzone {
            background: var(--peach);
            border: 3px dashed var(--primary);
            border-radius: 18px;
            min-height: 80px;
            min-width: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: var(--white);
            font-weight: bold;
            margin-bottom: 24px;
            margin-left: auto;
            margin-right: auto;
            transition: background 0.2s, border 0.2s;
        }
        .dropzone.active {
            background: var(--secondary);
            color: var(--forest-green);
            border-color: var(--peach);
        }
        #feedback {
            font-size: 1.2rem;
            margin: 18px 0;
            min-height: 28px;
        }
        /* Modals */
        .modal-bg {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.35);
            z-index: 100000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: var(--white);
            padding: 48px 40px;
            border-radius: 18px;
            max-width: 420px;
            width: 96vw;
            box-shadow: 0 4px 24px var(--peach);
            text-align: center;
            position: relative;
        }
        .modal-content h2 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 24px;
        }
        .modal-btn {
            padding: 18px 48px;
            border-radius: 12px;
            background: var(--primary);
            color: var(--white);
            border: none;
            font-size: 2rem;
            font-weight: bold;
            margin-top: 24px;
            cursor: pointer;
        }
        #edit-modal .modal-content label,
        #edit-modal .modal-content input,
        #edit-modal .modal-content button {
            font-size: 1.1rem;
            margin-bottom: 6px;
        }
        #edit-modal .modal-content input {
            width: 90%;
            padding: 6px 8px;
            margin-bottom: 8px;
            border-radius: 6px;
            border: 1px solid var(--primary);
        }
        #edit-modal .remove-question-btn {
            margin-left: 10px;
            color: #e57373;
            background: none;
            border: none;
            font-size: 1rem;
            cursor: pointer;
        }
        @media (max-width: 700px) {
            #edit-modal .modal-content { padding: 18px 4px; }
            #edit-modal .modal-content input { font-size: 1rem; }
            #edit-modal .modal-content label { font-size: 1rem; }
        }
    </style>
    
    </style>
</head>
<body>
    <!-- Site Header -->
    <header>
        <div class="floating-elements">
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <div class="floating-element"></div>
        </div>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-graduation-cap"></i></div>
                <div class="logo-text"><span>E</span><span>d</span><span>u</span><span>t</span><span>a</span><span>k</span><span>t</span><span>i</span><span>k</span><span>a</span></div>
            </div>
            <nav>
                <ul>
                    <li><a href="../../Student/homepage.html">Home</a></li>
                    <li><a href="../../Student/subject_math.html">Math</a></li>
                    <li><a href="../../Student/subject_english.html">English</a></li>
                    <li><a href="../../Student/subject_science.html">Science</a></li>
                    <li><a href="../../Student/leaderboard.html">Leaderboard</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
    <div class="page-wrapper">
    <!-- Start Screen -->
    <div id="start-modal" class="modal-bg" style="display:flex;">
        <div class="modal-content">
            <h2>Time & World Time Zones</h2>
            <p style="font-size:1.2rem;">Test your knowledge of 12/24-hour time and world time zones!</p>
            <button id="start-btn" class="modal-btn">Start</button>
        </div>
    </div>
    <!-- Instructions Modal -->
    <div id="instructions-modal" class="modal-bg">
        <div class="modal-content">
            <h2>Instructions</h2>
            <ul style="font-size:1.1rem; text-align:left; margin-bottom:24px;">
                <li>Read the question carefully.</li>
                <li>Drag the correct answer into the drop zone.</li>
                <li>Review your answer before moving to the next question.</li>
                <li>Try to get the highest score!</li>
            </ul>
            <button id="close-instructions-btn" class="modal-btn">Continue</button>
        </div>
    </div>
    <!-- Review Modal -->
    <div id="review-modal" class="modal-bg">
        <div class="modal-content">
            <h2 id="review-title"></h2>
            <p id="review-question" style="font-size:1.2rem;"></p>
            <p id="review-user-answer" style="font-size:1.2rem;"></p>
            <p id="review-correct-answer" style="font-size:1.2rem;"></p>
            <button id="next-btn" class="modal-btn">Next</button>
        </div>
    </div>
    <!-- Final Modal -->
    <div id="final-modal" class="modal-bg">
        <div class="modal-content">
            <h2>üèÜ Game Complete!</h2>
            <p id="final-score" style="font-size:1.3rem; margin-bottom:32px;"></p>
            <button id="play-again-btn" class="modal-btn">Back to Lessons</button>
        </div>
    </div>
    <div class="game-container" style="display:none;">
        <h2 style="color:var(--primary);margin-bottom:18px;">Time & World Time Zones</h2>
        <div class="question" id="question"></div>
        <div class="answers" id="answers"></div>
        <div class="dropzone" id="dropzone">Drop the correct answer here</div>
        <div id="feedback"></div>
        <div id="uploadStatus" style="font-size:13px;margin-top:10px;color:#444;"></div>
        <button id="viewAttemptsBtn" style="display:none;margin-top:12px; background:#6d28d9; color:#fff; border:none; padding:10px 18px; border-radius:8px; cursor:pointer;">View Attempts</button>
    </div>
    <button id="edit-game-btn" style="position: absolute; top: 20px; right: 20px; z-index: 1000; border-radius:6px; cursor:pointer;">Edit Game</button>
    <div id="edit-modal" class="modal-bg">
        <div class="modal-content" style="max-width:600px; width:96vw;">
            <h2 style="margin-top:0; margin-bottom:24px;">Edit Questions</h2>
            <div id="edit-questions-list" style="max-height:55vh; overflow-y:auto;"></div>
            <button id="add-question-btn" style="margin-top:18px; padding:8px 24px; border-radius:6px; background:var(--primary); color:#fff; border:none; font-size:16px;">Add Question</button>
            <div style="text-align:right; margin-top:24px;">
                <button id="save-edit-btn" style="padding:8px 24px; border-radius:6px; background:var(--primary); color:#fff; border:none; margin-right:12px; font-size:16px;">Save</button>
                <button id="close-edit-btn" style="padding:8px 24px; border-radius:6px; background:#eee; color:#333; border:none; font-size:16px;">Close</button>
            </div>
        </div>
    </div>
        <!-- Attempts Modal -->
        <div id="attemptsModal">
            <div class="modal-content">
                <h3 style="margin-top:0;">Your Attempts</h3>
                <div id="attemptsList">Loading...</div>
                <div style="text-align:right;margin-top:18px;">
                    <button onclick="closeAttemptsModal()">Close</button>
                </div>
            </div>
        </div>
        </div><!-- /page-wrapper -->
        </main>
        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <div class="footer-column">
                    <h3 class="edu">Edutaktika</h3>
                    <p>Making learning fun and engaging through interactive game-based education.</p>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="../../Student/homepage.html">Home</a></li>
                        <li><a href="../../Student/subject_math.html">Math</a></li>
                        <li><a href="../../Student/leaderboard.html">Leaderboard</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-links">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
                <p>¬© 2025 Edutaktika. All rights reserved.</p>
            </div>
        </footer>

        <link rel="stylesheet" href="../../CSS/attemptsModal.css">
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
        <script>
        // Firebase init
        const firebaseConfig = { apiKey:"AIzaSyB5BbeLLvPX8l1c4Lq0f-CmIUml4hQOQlE", authDomain:"edutaktika.firebaseapp.com", databaseURL:"https://edutaktika-default-rtdb.firebaseio.com", projectId:"edutaktika", storageBucket:"edutaktika.appspot.com", messagingSenderId:"676848575316", appId:"1:676848575316:web:f78f8c0f83bf3d9dfb5ec1", measurementId:"G-X3GT5TNN87" };
        if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();
        const QUIZ_KEY = 'lesson1';
        const USE_STUDENT_PATH = true; // fallback friendly
        function requireAuthUid(){ const u = auth.currentUser; if(!u){ document.getElementById('uploadStatus').textContent='Login required to save score.'; return null;} return u.uid; }
        function primaryAttemptRef(uid){ return db.ref(`quizAttempts/${QUIZ_KEY}/${uid}`).push(); }
        function studentAttemptRef(uid){ return db.ref(`students/${uid}/quizzes/${QUIZ_KEY}/attempts`).push(); }
        function summaryRefPrimary(uid){ return db.ref(`quizSummaries/${QUIZ_KEY}/${uid}`); }
        function summaryRefStudent(uid){ return db.ref(`students/${uid}/quizzes/${QUIZ_KEY}/summary`); }
        function saveAttempt(rawScore,total){
             const uid = requireAuthUid(); if(!uid) return;
             const payload = { score:rawScore, total:total, percentage: Math.round(rawScore/total*100), timestamp: Date.now() };
             const statusEl = document.getElementById('uploadStatus');
             statusEl.textContent='Saving attempt...';
             const tryPrimary = !USE_STUDENT_PATH;
             const doPrimary = () => primaryAttemptRef(uid).set(payload).then(()=> updateSummary(uid,payload,true));
             const doStudent = () => studentAttemptRef(uid).set(payload).then(()=> updateSummary(uid,payload,false));
             (tryPrimary ? doPrimary().catch(err=>{ if(err && err.code==='PERMISSION_DENIED') return doStudent(); throw err; }) : doStudent())
                 .then(()=>{ statusEl.textContent='Attempt saved ‚úÖ'; document.getElementById('viewAttemptsBtn').style.display='inline-block'; loadAttempts(); })
                 .catch(e=>{ statusEl.textContent='Save failed: '+ e.message; console.error(e); });
        }
        function updateSummary(uid,payload,usedPrimary){
             const ref = (USE_STUDENT_PATH || !usedPrimary) ? summaryRefStudent(uid) : summaryRefPrimary(uid);
             let bestDelta = 0;
             return ref.transaction(current => {
                    if(!current){ bestDelta = payload.score; return { best:payload.score, bestPercentage:payload.percentage, last:payload.score, lastPercentage:payload.percentage, total:payload.total, attempts:1, lastTimestamp:payload.timestamp }; }
                    const prevBest = current.best || 0;
                    const best = Math.max(prevBest, payload.score);
                    if(best > prevBest) bestDelta = best - prevBest;
                    return { best, bestPercentage: Math.round(best/payload.total*100), last: payload.score, lastPercentage: payload.percentage, total: payload.total, attempts: (current.attempts||0)+1, lastTimestamp: payload.timestamp };
             }).then(()=>{ if(bestDelta>0){ db.ref(`students/${uid}/points`).transaction(p => (p||0)+bestDelta); } });
        }
        function openAttemptsModal(){ document.getElementById('attemptsModal').style.display='flex'; loadAttempts(); }
        function closeAttemptsModal(){ document.getElementById('attemptsModal').style.display='none'; }
        window.closeAttemptsModal = closeAttemptsModal;
        function loadAttempts(){
             const uid = requireAuthUid(); if(!uid) return;
             const listDiv = document.getElementById('attemptsList'); listDiv.textContent='Loading...';
             const path = (USE_STUDENT_PATH ? `students/${uid}/quizzes/${QUIZ_KEY}/attempts` : `quizAttempts/${QUIZ_KEY}/${uid}`);
             db.ref(path).orderByChild('timestamp').once('value').then(snap=>{
                    if(!snap.exists()){ listDiv.textContent='No attempts yet.'; return; }
                    const rows=[]; snap.forEach(c=>rows.push(c.val())); rows.sort((a,b)=> b.timestamp - a.timestamp);
                    listDiv.innerHTML = rows.map((a,i)=>{ const ds = new Date(a.timestamp).toLocaleString(); return `<div class='attempt-row'><span>#${rows.length - i}</span><span>${a.score}/${a.total}</span><span>${a.percentage}%</span><span>${ds}</span></div>`; }).join('');
             }).catch(e=>{ listDiv.textContent='Load failed: '+ e.message; });
        }
        document.getElementById('viewAttemptsBtn').addEventListener('click', openAttemptsModal);
        auth.onAuthStateChanged(u=>{ if(u){ document.getElementById('viewAttemptsBtn').style.display='inline-block'; loadAttempts(); } });
        </script>
        <script>
        // Existing game logic (augmented with saveAttempt call)
        // Questions for 12/24-hour time and world time zones
        let current = 0;
        let score = 0;
        let userAnswer = "";

        // Start screen logic
        document.getElementById('start-btn').onclick = function() {
            document.getElementById('start-modal').style.display = 'none';
            document.getElementById('instructions-modal').style.display = 'flex';
        };

        // Hide Edit button initially
        document.getElementById('edit-game-btn').style.display = 'none';

        document.getElementById('close-instructions-btn').onclick = function() {
            document.getElementById('instructions-modal').style.display = 'none';
            document.querySelector('.game-container').style.display = '';
            document.getElementById('edit-game-btn').style.display = ''; // Show Edit button after instructions
            loadQuestion();
        };

        function loadQuestion() {
            document.getElementById('question').innerHTML = questions[current].q;
            document.getElementById('feedback').textContent = '';
            userAnswer = "";
            // Answers
            const answersDiv = document.getElementById('answers');
            answersDiv.innerHTML = '';
            questions[current].choices.forEach(ans => {
                const btn = document.createElement('div');
                btn.className = 'draggable';
                btn.textContent = ans;
                btn.draggable = true;
                btn.ondragstart = function(e) {
                    btn.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', ans);
                };
                btn.ondragend = function() {
                    btn.classList.remove('dragging');
                };
                answersDiv.appendChild(btn);
            });
            // Dropzone
            const dropzone = document.getElementById('dropzone');
            dropzone.textContent = "Drop the correct answer here";
            dropzone.classList.remove('active');
            dropzone.ondragover = function(e) {
                e.preventDefault();
                dropzone.classList.add('active');
            };
            dropzone.ondragleave = function() {
                dropzone.classList.remove('active');
            };
            dropzone.ondrop = function(e) {
                e.preventDefault();
                dropzone.classList.remove('active');
                const dropped = e.dataTransfer.getData('text/plain');
                dropzone.textContent = dropped;
                userAnswer = dropped;
                showReviewModal(dropped);
            };
        }

        function showReviewModal(ans) {
            let correct = ans === questions[current].a;
            document.getElementById('review-title').textContent = correct ? "‚úÖ Correct!" : "‚ùå Incorrect!";
            document.getElementById('review-question').innerHTML = "Question: " + questions[current].q;
            document.getElementById('review-user-answer').innerHTML = "Your answer: <b>" + ans + "</b>";
            document.getElementById('review-correct-answer').innerHTML = correct ? "" : "Correct answer: <b>" + questions[current].a + "</b>";
            document.getElementById('review-modal').style.display = 'flex';
            if (correct) score++;
        }

        document.getElementById('next-btn').onclick = function() {
            document.getElementById('review-modal').style.display = 'none';
            current++;
            if (current < questions.length) {
                loadQuestion();
            } else {
                showFinalModal();
            }
        };

        function showFinalModal() {
            document.getElementById('final-score').textContent = `Your score: ${score} / ${questions.length}`;
            document.getElementById('final-modal').style.display = 'flex';
            // Save attempt to Firebase
            saveAttempt(score, questions.length);
        }

        document.getElementById('play-again-btn').onclick = function() {
            // Redirect to lessons/quiz menu (Math subject page)
            window.location.href = '../../Student/subject_math.html';
        };

        // Edit button logic
        document.getElementById('edit-game-btn').onclick = function() {
            showEditModal();
        };

        function showEditModal() {
            document.getElementById('edit-modal').style.display = 'flex';
            const list = document.getElementById('edit-questions-list');
            list.innerHTML = '';
            editableQuestions.forEach((q, idx) => {
                list.innerHTML += `
                    <div style="margin-bottom:18px; border-bottom:1px solid #eee; padding-bottom:8px;">
                        <label>Question:<br>
                            <input type="text" class="edit-q" data-idx="${idx}" value="${q.q.replace(/"/g, '&quot;')}">
                        </label><br>
                        <label>Choices (comma separated):<br>
                            <input type="text" class="edit-choices" data-idx="${idx}" value="${q.choices.join(', ')}">
                        </label><br>
                        <label>Correct Answer:<br>
                            <input type="text" class="edit-correct" data-idx="${idx}" value="${q.a}">
                        </label>
                        <button class="remove-question-btn" data-idx="${idx}">Remove</button>
                    </div>
                `;
            });
            // Remove logic
            list.querySelectorAll('.remove-question-btn').forEach(btn => {
                btn.onclick = function() {
                    const idx = Number(btn.dataset.idx);
                    editableQuestions.splice(idx, 1);
                    showEditModal();
                };
            });
        }

        // Add question
        document.getElementById('add-question-btn').onclick = function() {
            editableQuestions.push({ q: "New Question", choices: ["Choice 1", "Choice 2", "Choice 3"], a: "Choice 1" });
            showEditModal();
        };

        // Save edits
        document.getElementById('save-edit-btn').onclick = function() {
            document.querySelectorAll('.edit-q').forEach(input => {
                const idx = input.dataset.idx;
                editableQuestions[idx].q = input.value.trim();
            });
            document.querySelectorAll('.edit-choices').forEach(input => {
                const idx = input.dataset.idx;
                editableQuestions[idx].choices = input.value.split(',').map(a => a.trim());
            });
            document.querySelectorAll('.edit-correct').forEach(input => {
                const idx = input.dataset.idx;
                editableQuestions[idx].a = input.value.trim();
            });
            localStorage.setItem('lesson1Questions', JSON.stringify(editableQuestions)); // Save to localStorage
            document.getElementById('edit-modal').style.display = 'none';
            // Reset game with new questions
            current = 0;
            score = 0;
            document.querySelector('.game-container').style.display = '';
            loadQuestion();
        };

        // Close modal
        document.getElementById('close-edit-btn').onclick = function() {
            document.getElementById('edit-modal').style.display = 'none';
        };

        // Load questions from localStorage if available
        let editableQuestions = [
            {
                q: "What is <b>15:00</b> in 12-hour time?",
                choices: ["3:00 AM", "3:00 PM", "12:00 PM"],
                a: "3:00 PM"
            },
            {
                q: "What is <b>7:30 PM</b> in 24-hour time?",
                choices: ["19:30", "07:30", "17:30"],
                a: "19:30"
            },
            {
                q: "If it is <b>10:00 AM</b> in Manila (UTC+8), what time is it in London (UTC+0)?",
                choices: ["2:00 AM", "6:00 AM", "10:00 AM"],
                a: "2:00 AM"
            },
            {
                q: "What is the difference in hours between UTC+8 and UTC-5?",
                choices: ["13", "3", "8"],
                a: "13"
            },
            {
                q: "What is <b>12:00 AM</b> in 24-hour time?",
                choices: ["00:00", "12:00", "24:00"],
                a: "00:00"
            },
            {
                q: "If it is <b>18:00</b> in New York (UTC-5), what time is it in Manila (UTC+8)?",
                choices: ["7:00 AM", "11:00 AM", "1:00 AM"],
                a: "7:00 AM"
            }
        ];
        if (localStorage.getItem('lesson1Questions')) {
            editableQuestions = JSON.parse(localStorage.getItem('lesson1Questions'));
        }
        // Use editableQuestions for the game
        const questions = editableQuestions;

        // Show start screen on load
        document.getElementById('start-modal').style.display = 'flex';
        document.getElementById('instructions-modal').style.display = 'none';
        document.getElementById('review-modal').style.display = 'none';
        document.getElementById('final-modal').style.display = 'none';
        document.querySelector('.game-container').style.display = 'none';
    </script>
    </body>
    </html>
</body>
</html>