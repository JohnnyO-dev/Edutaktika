 <script>
    document.addEventListener("DOMContentLoaded", function() {
        firebase.auth().onAuthStateChanged(async function(user) {
            if (!user) {
                window.location.href = "logreg.html";
                return;
            }
            const uid = user.uid;
            const snap = await firebase.database().ref('teachers/' + uid).once('value');
            const teacher = snap.val();
            if (!teacher || teacher.role !== "teacher") {
                document.getElementById('mainContent').style.display = "none";
                alert("Access denied.");
                await firebase.auth().signOut();
                window.location.href = "logreg.html";
            } else {
                document.getElementById('mainContent').style.display = "block";
            }
        });
    });
    </script>
    
    <!-- Leaderboard for Kids - Example HTML & CSS -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <title>Leaderboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../CSS/header.css">
    <link rel="stylesheet" href="../CSS/leaderboard.css">
    <link rel="stylesheet" href="../CSS/footer.css">
    <link rel="stylesheet" href="../CSS/dropdown.css">
    <link rel="stylesheet" href="../CSS/burger.css">
    <link rel="icon" type="image/png" href="../images/icons/winner.png" />

</head>
<body>
<div id="mainContent" style="display:none;">
    <!-- Burger icon for mobile -->
<button id="burgerBtn" class="burger-btn" aria-label="Open menu">
    <span></span>
    <span></span>
    <span></span>
</button>
    <header>
        <div class="floating-elements">
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <div class="floating-element"></div>
        </div>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <!-- Replace your logo-text div with this for per-letter bounce -->
                <div class="logo-text">
                    <span>E</span><span>d</span><span>u</span><span>t</span><span>a</span><span>k</span><span>t</span><span>i</span><span>k</span><span>a</span>
                </div>
            </div>
            <nav>
                <ul>
                    <li><a href="homepage.html">Home</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropbtn">Subject <i class="fa fa-caret-down"></i></a>
                        <ul class="dropdown-content">
                            <li><a href="subject_math.html">Math</a></li>
                            <li><a href="subject_english.html">English</a></li>
                            <li><a href="subject_science.html">Science</a></li>
                        </ul>
                    </li>
                    <li><a href="studentlist.html">Student</a></li>
                    <li class="dropdown">
                            <a href="#" class="dropbtn">Leaderboard <i class="fa fa-caret-down"></i></a>
                            <ul class="dropdown-content">
                                <li><a href="leaderboard_math.html">Math</a></li>
                                <li><a href="leaderboard_english.html">English</a></li>
                                <li><a href="leaderboard_science.html">Science</a></li>
                            </ul>
                        </li>
                    <li>
                    <li>
                        <a href="#" id="profileBtn"><i class="fas fa-user-circle"></i> Profile</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

<!-- Overlay for navbar -->
<div class="sidebar-overlay" id="navOverlay"></div>
<!-- Overlay for profile sidebar -->
<div class="sidebar-overlay" id="profileSidebarOverlay"></div>

 <!-- Profile Sidebar (Dynamic with Firebase) -->
<div id="profileSidebar" class="profile-sidebar">
    <div class="sidebar-content">
        <button class="close-btn" id="closeSidebar">&times;</button>
        <div style="position:relative; display:flex; flex-direction:column; align-items:center;">
            <img class="profile-avatar" id="profileAvatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=user" alt="Profile Avatar">
            <i class="fa-solid fa-star sidebar-star" style="position:absolute; bottom:0; right:10px; color:#ffd700; font-size:1.2rem; background:white; border-radius:50%; padding:2px 4px; box-shadow:0 1px 4px #ffd70044;"></i>
        </div>
        <div class="profile-name" id="profileName">Loading...</div>
        <br>
        <div class="profile-info" style="width:100%;max-width:260px;margin-bottom:24px;">
            <div class="profile-role" style="color:#2e8b57; font-weight:700; font-size:1.1rem; margin-bottom:8px; letter-spacing:1px; text-align:center;">
            Teacher
        </div>
            <div>
                <i class="fa-solid fa-id-badge" style="color:violet;margin-right:10px;"></i>
                <strong>ID:</strong> <span id="profileId">-</span>
            </div>
            <div>
                <i class="fa-solid fa-user" style="color:#ff69b4;margin-right:10px;"></i>
                <strong>First Name:</strong> <span id="profileFirstName">-</span>
            </div>
            <div>
                <i class="fa-solid fa-user" style="color:#ffd700;margin-right:10px;"></i>
                <strong>Middle Name:</strong> <span id="profileMiddleName">-</span>
            </div>
            <div>
                <i class="fa-solid fa-user" style="color:#f14141;margin-right:10px;"></i>
                <strong>Last Name:</strong> <span id="profileLastName">-</span>
            </div>
            <div>
                <i class="fa-solid fa-graduation-cap" style="color:#2e8b57;margin-right:10px;"></i>
                <strong>Grade Level:</strong> <span id="profileGrade">-</span>
            </div>
            <div>
                <i class="fa-solid fa-apple-whole" style="color:#4faaff;margin-right:10px;"></i>
                <strong>Section:</strong> <span id="profileSection">-</span>
            </div>
            <div>
    <i class="fas fa-map-marker-alt" style="color:#ff69b4;margin-right:10px;"></i>
    <strong>House/Street:</strong> <span id="profileAddressStreet">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#ffd700;margin-right:10px;"></i>
    <strong>Barangay:</strong> <span id="profileAddressBarangay">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#4faaff;margin-right:10px;"></i>
    <strong>City:</strong> <span id="profileAddressCity">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#2e8b57;margin-right:10px;"></i>
    <strong>Province:</strong> <span id="profileAddressProvince">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#f14141;margin-right:10px;"></i>
    <strong>ZIP:</strong> <span id="profileAddressZip">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:violet;margin-right:10px;"></i>
    <strong>Region:</strong> <span id="profileAddressRegion">-</span>
</div>
        </div>
        <div class="logout-switch-row">
            <div class="logout-switch" id="logoutSwitch">
                <div class="logout-switch-circle"></div>
            </div>
            <span class="logout-label" id="logoutLabel">LOGOUT</span>
        </div>
    </div>
</div>
<style>
    .profile-sidebar {
    margin-top: 20px;
    max-height: 95vh;
    overflow-y: auto;
    scrollbar-width: none;         /* Firefox */
    -ms-overflow-style: none;      /* IE and Edge */
}
.profile-sidebar::-webkit-scrollbar {
    display: none;                 /* Chrome, Safari, Opera */
}
</style>


        <!-- Firebase App (the core Firebase SDK) -->
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

        <script src="../assets/js/Teacher Side/profile.js"></script>

    <script src="../assets/js/Teacher Side/header.js"></script>

    <div class="leaderboard-container">
        <div class="leaderboard-title">🌟 Student Leaderboard 🌟</div>
        <div class="leaderboard-desc">See who's on top this week! Play games, earn points, and climb the ranks!</div>
        <!-- Podium -->
        <div class="podium" id="podium"></div>
        <!-- Leaderboard Table -->
        <table class="leaderboard-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Player</th>
                    <th>Points</th>
                    <th>Badges</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                <!-- Leaderboard rows will be inserted here -->
            </tbody>
        </table>
                   <!-- Dynamic Pagination -->
            <div id="pagination" class="pagination" aria-label="Leaderboard pages"></div>
    </div>
    
    <script>
    // 1. Firebase config (replace with your own)
   

    // 2. Fetch and display leaderboard
    async function loadLeaderboard() {
        const snapshot = await db.ref('students').orderByChild('points').once('value');
        let students = [];
        snapshot.forEach(child => {
            const s = child.val();
            s._key = child.key;
            students.push(s);
        });
        // Sort descending by points
        students.sort((a, b) => (b.points || 0) - (a.points || 0));

        // Podium (top 3)
        const podiumIndices = [1, 0, 2]; // 2nd, 1st, 3rd
        const podiumClasses = ['silver', 'gold', 'bronze'];
        const podiumRanks = [2, 1, 3];
        let podiumHtml = '';
        podiumIndices.forEach((studentIdx, i) => {
            if (!students[studentIdx]) return;
            const student = students[studentIdx];
            const avatar = student.avatar ? student.avatar : `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent((student.fname||'') + (student.lname||''))}`;
            podiumHtml += `
            <div class="podium-place ${podiumClasses[i]}">
                <div class="podium-rank">${podiumRanks[i]}</div>
                <img src="${avatar}" class="avatar" alt="${student.fname||''}">
                <div class="podium-name">${(student.fname||'') + ' ' + (student.lname||'')}</div>
                <div class="podium-score">${parseInt(student.points)||0} pts</div>
            </div>`;
        });
        document.getElementById('podium').innerHTML = podiumHtml;

        // Leaderboard table
        let tbodyHtml = '';
        students.forEach((student, idx) => {
            const avatar = student.avatar ? student.avatar : `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent((student.fname||'') + (student.lname||''))}`;
            let badges = "🏅";
            if (idx === 0) badges = "🏅🏅🏅";
            else if (idx === 1) badges = "🏅🏅";
            tbodyHtml += `
            <tr${idx === 0 ? ' class="me"' : ''}>
                <td>${idx + 1}</td>
                <td>
                    <span class="player-cell">
                        <img src="${avatar}" class="avatar-small" alt="${student.fname||''}">
                        <span class="player-name">${(student.fname||'') + ' ' + (student.lname||'')}</span>
                        <span class="tooltiptext">${idx === 0 ? "Top scorer!" : "Great job!"}</span>
                    </span>
                </td>
                <td>${parseInt(student.points)||0}</td>
                <td>${badges}</td>
            </tr>`;
        });
        document.getElementById('leaderboard-body').innerHTML = tbodyHtml;
    }

    // Show all students under the same section as the logged-in teacher
    async function loadSectionStudents() {
        // Get current teacher's section
        const user = firebase.auth().currentUser;
        if (!user) return;
        const teacherUID = user.uid;
        const teacherSnap = await db.ref('teachers/' + teacherUID).once('value');
        const teacher = teacherSnap.val();
        if (!teacher || !teacher.section) return;

        const section = teacher.section;

        // Fetch all students in the same section
        const studentsSnap = await db.ref('students').orderByChild('section').equalTo(section).once('value');
        let students = [];
        studentsSnap.forEach(child => {
            const s = child.val();
            s._key = child.key;
            students.push(s);
        });

        // Sort by points (optional)
        students.sort((a, b) => (b.points || 0) - (a.points || 0));

        // Render leaderboard table
        let tbodyHtml = '';
        students.forEach((student, idx) => {
            const avatar = student.avatar ? student.avatar : `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent((student.fname||'') + (student.lname||''))}`;
            let badges = "🏅";
            if (idx === 0) badges = "🏅🏅🏅";
            else if (idx === 1) badges = "🏅🏅";
            tbodyHtml += `
            <tr${idx === 0 ? ' class="me"' : ''}>
                <td>${idx + 1}</td>
                <td>
                    <span class="player-cell">
                        <img src="${avatar}" class="avatar-small" alt="${student.fname||''}">
                        <span class="player-name">${(student.fname||'') + ' ' + (student.lname||'')}</span>
                        <span class="tooltiptext">${idx === 0 ? "Top scorer!" : "Great job!"}</span>
                    </span>
                </td>
                <td>${parseInt(student.points)||0}</td>
                <td>${badges}</td>
            </tr>`;
        });
        document.getElementById('leaderboard-body').innerHTML = tbodyHtml;
    }

    // Use this instead of loadLeaderboard
    document.addEventListener('DOMContentLoaded', function() {
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) loadSectionStudents();
        });
    });
    </script>

    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h3 class="edu">Eduktaktika</h3>
                <p>
                    Making learning fun and engaging through interactive game-based
                    education.
                </p>
            </div>
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="homepage.php">Home</a></li>
                    <li><a href="subjectTeacher.php">Subject</a></li>
                    <li><a href="studentlistTeacher.php">Student</a></li>
                    <li><a href="leaderboardTeacher.php">Leaderboard</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Support</h3>
                <ul>
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="footer-links">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
            </div>
            <p>© 2023 Eduktaktika. All rights reserved.</p>
        </div>
    </footer>

        <!-- Edit Profile Modal -->

<link rel="stylesheet" href="../CSS/editProfile.css">

<div id="editProfileModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:99999;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:32px 28px;border-radius:14px;max-width:350px;width:90%;box-shadow:0 4px 24px #0002;text-align:left;position:relative;">
        <h3 style="margin-top:0;">Edit Profile</h3>
        <form id="editProfileForm">
            <label>First Name:<br>
                <input type="text" id="edit_fname" required>
            </label><br><br>
            <label>Middle Name:<br>
                <input type="text" id="edit_mname">
            </label><br><br>
            <label>Last Name:<br>
                <input type="text" id="edit_lname" required>
            </label><br><br>
            <label>Grade Level:<br>
                <input type="text" id="edit_gradelevel">
            </label><br><br>
            <label>Section:<br>
                <input type="text" id="edit_section">
            </label><br><br>
            <div style="text-align:right;">
                <button type="button" onclick="closeEditProfileModal()" style="margin-right:10px;">Cancel</button>
                <button type="submit">Save</button>
            </div>
        </form>
    </div>
</div>

<script src="../assets/js/Teacher Side/editProfile.js"></script>
<script src="../assets/js/navbar.js"></script>
<script>
/* === Add near top of your leaderboard script (after Firebase refs) === */
const PAGE_SIZE = 10;
let SECTION_STUDENTS = [];

/* Replace ONLY the current loadSectionStudents function with this one */
async function loadSectionStudents() {
    const user = firebase.auth().currentUser;
    if (!user) return;
    const teacherSnap = await db.ref('teachers/' + user.uid).once('value');
    const teacher = teacherSnap.val();
    if (!teacher || !teacher.section) return;
    const section = teacher.section;

    const studentsSnap = await db.ref('students').orderByChild('section').equalTo(section).once('value');
    SECTION_STUDENTS = [];
    studentsSnap.forEach(child => {
        const s = child.val() || {};
        s._key = child.key;
        s.points = parseInt(s.points || 0) || 0;
        SECTION_STUDENTS.push(s);
    });

    SECTION_STUDENTS.sort((a,b)=>
        b.points - a.points ||
        ((a.fname||'')+(a.lname||'')).localeCompare((b.fname||'')+(b.lname||'')));

    renderPodium();
    renderLeaderboardPage(1);
}

/* Podium (unchanged logic, now uses SECTION_STUDENTS) */
function renderPodium(){
    const students = SECTION_STUDENTS;
    const podiumIndices = [1,0,2];
    const podiumClasses = ['silver','gold','bronze'];
    const podiumRanks = [2,1,3];
    let html = '';
    podiumIndices.forEach((idx,i)=>{
        if(!students[idx]) return;
        const st = students[idx];
        const avatar = st.avatar || `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent((st.fname||'')+(st.lname||''))}`;
        html += `<div class="podium-place ${podiumClasses[i]}">
            <div class="podium-rank">${podiumRanks[i]}</div>
            <img src="${avatar}" class="avatar" alt="">
            <div class="podium-name">${(st.fname||'')+' '+(st.lname||'')}</div>
            <div class="podium-score">${st.points} pts</div>
        </div>`;
    });
    document.getElementById('podium').innerHTML = html;
}

/* NEW: Paginated table renderer */
function renderLeaderboardPage(page){
    const tbody = document.getElementById('leaderboard-body');
    const pag = document.getElementById('pagination');
    const total = SECTION_STUDENTS.length;
    const pages = Math.max(1, Math.ceil(total / PAGE_SIZE));
    if(page < 1) page = 1;
    if(page > pages) page = pages;
    const start = (page - 1) * PAGE_SIZE;
    const slice = SECTION_STUDENTS.slice(start, start + PAGE_SIZE);

    tbody.innerHTML = slice.map((s,i)=>{
        const rank = start + i + 1;
        const avatar = s.avatar || `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent((s.fname||'')+(s.lname||''))}`;
        let badges = '🏅';
        if(rank === 1) badges = '🏅🏅🏅';
        else if(rank === 2) badges = '🏅🏅';
        return `<tr${rank===1?' class="me"':''}>
            <td>${rank}</td>
            <td>
              <span class="player-cell">
                <img src="${avatar}" class="avatar-small" alt="">
                <span class="player-name">${(s.fname||'')+' '+(s.lname||'')}</span>
                <span class="tooltiptext">${rank===1?'Top scorer!':'Great job!'}</span>
              </span>
            </td>
            <td>${s.points}</td>
            <td>${badges}</td>
        </tr>`;
    }).join('');

    // Build pagination
    if(pages <= 1){
        pag.innerHTML = '';
        return;
    }
    let html = `<button ${page===1?'disabled':''} data-page="${page-1}">&lt;</button>`;
    for(let p=1; p<=pages; p++){
        if(p===1 || p===pages || Math.abs(p - page) <= 1){
            html += `<button class="${p===page?'active':''}" data-page="${p}">${p}</button>`;
        } else if(Math.abs(p - page) === 2){
            html += `<span class="ellipsis">...</span>`;
        }
    }
    html += `<button ${page===pages?'disabled':''} data-page="${page+1}">&gt;</button>`;
    pag.innerHTML = html;
    pag.querySelectorAll('button[data-page]').forEach(btn=>{
        btn.onclick = () => renderLeaderboardPage(parseInt(btn.dataset.page));
    });
}

/* Auth listener (keep single) */
document.addEventListener('DOMContentLoaded', ()=>{
    firebase.auth().onAuthStateChanged(user=>{
        if(user) loadSectionStudents();
    });
});
</script>
<style>
    /* Add near end inside a <style> block if not present */
.pagination{
  display:flex;
  gap:6px;
  justify-content:center;
  margin:16px 0 4px;
  flex-wrap:wrap;
}
.pagination button{
  background:#2e8b57;
  color:#fff;
  border:0;
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
  font-size:.75rem;
  font-weight:600;
}
.pagination button.active{
  background:#ffd54f;
  color:#2d3923;
}
.pagination button:disabled{
  background:#b7c8bb;
  cursor:not-allowed;
}
.pagination .ellipsis{
  padding:6px 4px;
  font-size:.75rem;
  color:#555;
  user-select:none;
}
@media (max-width:560px){
  .pagination button{padding:5px 10px;font-size:.68rem;}
}
</style>

</div>
</body>
</html>